<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BZTracker</title>
  
  <!-- Load external libraries: Chart.js, date adapter, zoom plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1" defer></script>
  
  <!-- Load your local CSS from the 'static' folder -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="dark-theme">
  <!-- Particle Container -->
  <div id="particle-container"></div>
  <!-- Icicles (visible only in Light theme) -->
  <div id="icicles">
    <div class="icicle"></div>
    <div class="icicle"></div>
    <div class="icicle"></div>
    <div class="icicle"></div>
    <div class="icicle"></div>
  </div>

  <!-- SIDEBAR TOGGLE & SOUND TOGGLES -->
  <button id="menuToggle">‚ò∞</button>
  <button id="soundToggle">üîá</button>

  <!-- SIDEBAR -->
  <div id="sidebar">
    <h1>BZTracker</h1>
    <ul>
      <li><a href="#search-section">Search</a></li>
      <li><a href="#graph-section">Price Graph</a></li>
      <li><a href="#top-margins-section">Top Margins</a></li>
      <li><a href="#profitability-section">Profitability</a></li>
      <li><a href="#top-variations-section">Top Variations</a></li>
      <li><a href="#settings-section">Settings</a></li>
    </ul>
  </div>
  <div id="overlay"></div>

  <!-- MAIN CONTENT WRAPPER -->
  <div id="mainContent">
    <!-- ============ SEARCH SECTION ============ -->
    <section id="search-section">
      <h2>Search</h2>
      <form id="search-form">
        <input 
          type="text" 
          id="item-search" 
          placeholder="Search for an item..." 
          autocomplete="off"
        />
        <div id="suggestions"></div>
        <button type="submit">Search</button>
      </form>
      <div id="loader"><div class="spinner"></div></div>
      <div id="result"></div>
    </section>

    <!-- ============ GRAPH SECTION ============ -->
    <section id="graph-section">
      <h2>Price Graph</h2>
      <p class="graph-subtitle">
        Interactive graph with advanced trendlines, moving averages, forecast predictions, and recommended buy/sell levels.
      </p>
      <div class="graph-layout">
        <!-- Chart Area (Left Column) -->
        <div id="chart-area">
          <canvas id="priceGraph"></canvas>
          <div id="forecast-accuracy"></div>
          <div id="recommended-prices"></div>
        </div>
        
        <!-- Control Panel (Right Column) -->
        <div id="graph-controls">
          <!-- Time Range Buttons -->
          <div class="time-range-buttons">
            <button class="time-range-btn" data-range="1h">1 Hour</button>
            <button class="time-range-btn" data-range="24h">1 Day</button>
            <button class="time-range-btn" data-range="1w">1 Week</button>
            <button class="time-range-btn" data-range="1y">1 Year</button>
            <button class="time-range-btn" data-range="all">All Time</button>
          </div>
          
          <!-- Trendline & Forecast Toggles -->
          <div id="trendline-controls">
            <div class="toggle-group">
              <span>Linear</span>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-linear" checked>
                <span class="slider"></span>
              </label>
            </div>
            <div class="toggle-group">
              <span>Exponential</span>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-exponential">
                <span class="slider"></span>
              </label>
            </div>
            <div class="toggle-group">
              <span>Moving Avg</span>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-moving-average">
                <span class="slider"></span>
              </label>
            </div>
            <div class="toggle-group">
              <span>Forecast</span>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-forecast">
                <span class="slider"></span>
              </label>
            </div>
            <div class="toggle-group">
              <span>Holt‚ÄëWinters</span>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-holt-winters">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          
          <!-- Extra Controls -->
          <div id="extra-controls">
            <button id="downloadGraph" class="time-range-btn">Download Graph</button>
            <div class="target-sell">
              <label for="target-sell-price">Target Sell Price:</label>
              <input 
                type="number" 
                id="target-sell-price" 
                placeholder="Enter target sell" 
                step="0.01"
              />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============ TOP MARGINS SECTION ============ -->
    <section id="top-margins-section" class="small">
      <h2>Top 10 Items with Highest Margins</h2>
      <div>
        <label for="sort-by">Sort by:</label>
        <select id="sort-by">
          <option value="margin" selected>Margin</option>
          <option value="buy_price">Buy Price</option>
          <option value="sell_price">Sell Price</option>
          <option value="demand">Demand</option>
          <option value="supply">Supply</option>
        </select>
        
        <label for="order">Order:</label>
        <select id="order">
          <option value="desc" selected>Descending</option>
          <option value="asc">Ascending</option>
        </select>
        
        <button id="refresh-top-margins">Refresh</button>
      </div>
      <div id="top-margins"></div>
    </section>

    <!-- ============ PROFITABILITY SECTION ============ -->
    <section id="profitability-section">
      <h2>Profitability (Coins Per Hour)</h2>
      <div style="margin-bottom:10px;">
        <label for="coins">Coins:</label>
        <input type="number" id="coins" value="0"/>
        
        <label for="difficulty">Difficulty:</label>
        <input type="number" id="difficulty" value="1" step="0.1"/>
        
        <button id="calculate-profit">Calculate Profit</button>
      </div>
      <div id="profitability-result"></div>
    </section>

    <!-- ============ TOP VARIATIONS SECTION ============ -->
    <section id="top-variations-section">
      <h2>Top 10 Items with Highest Price Variations</h2>
      <div>
        <label for="variation-time-range">Time Range:</label>
        <select id="variation-time-range">
          <option value="3600">1 Hour</option>
          <option value="86400">1 Day</option>
          <option value="604800">1 Week</option>
        </select>
        <button id="refresh-top-variations">Refresh</button>
      </div>
      <div id="top-variations"></div>
    </section>

    <!-- ============ SETTINGS SECTION ============ -->
    <section id="settings-section">
      <h2>Settings</h2>
      <div id="theme-toggle-container">
        <label for="theme-select"><strong>Theme:</strong></label>
        <select id="theme-select">
          <option value="dark">Dark (Obsidian)</option>
          <option value="light">Light (Ice)</option>
        </select>
      </div>
      <p>
        Use this dropdown to switch between the dark ‚ÄúCrying Obsidian‚Äù theme and the light ‚ÄúIce‚Äù theme.
        In light mode, enjoy a frosty interface with falling snow and icicles.
        Forecasting functions automatically extend 100 periods into the future.
        Forecast accuracy is computed as ((forecast ‚Äì actual) / forecast) * 100 for each forecasted point,
        and both the simple forecast (using a 5‚Äëpoint holdout) and the Holt‚ÄëWinters forecast are always displayed.
        Additionally, a recommended buy price (lowest recorded buy) and a recommended sell price (highest recorded sell)
        are computed from the current data.
      </p>
    </section>
  </div>

  <!-- BACKGROUND MUSIC -->
  <audio 
    id="bgMusic" 
    src="https://cdn.pixabay.com/download/audio/2022/10/14/audio_9f8b1101b0.mp3?filename=mystic-realm-of-minecraft-235545.mp3" 
    loop
  ></audio>

  <!-- Load your local JS from the 'static' folder -->
  <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</body>
</html>
